<div class="ocaml_top"><div class="ocaml_summary"/>
<div class="ocaml_content"><pre class="odoccode"><span class="TYPEt"><span class="keyword">type</span> <code class="type">'a </code>t</span></pre>
<div class="ocaml_include" path="http://127.0.0.1:8000/core/#Std.Invariant:S1" items="[]" types="[]"><pre class="ocaml_include_handle"><span class="keyword">include</span> <code class="type"><code class="code"><a href="http://127.0.0.1:8000/core/#Std.Invariant:S1">Core.Std.Invariant.S1</a></code> with type t := 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a></code></pre><div class="ocaml_summary"/></div>
<pre class="odoccode"><span class="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">can_subscribe_after_start:bool -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a></code></pre><div class="info"><code class="code">create</code> creates a new, unstarted, bus.<p><code class="code">can_subscribe_after_start</code> determines whether <code class="code">subscribe_exn</code> succeeds after the bus
is started.</p></div>
<pre class="odoccode"><span class="VALstart"><span class="keyword">val</span> start</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">start t</code> starts the bus; it starts delivery of queued messages to readers. <code class="code">start</code>
will not run any subscribers; it just creates the Async job that will start running
them.</div>
<pre class="odoccode"><span class="VALflushed"><span class="keyword">val</span> flushed</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; unit <a href="http://127.0.0.1:8000/async_extra/#Import.Deferred.t">Import.Deferred.t</a></code></pre><div class="info"><code class="code">flushed t</code> returns a deferred that becomes determined when all subscribers have
processed all values previously writen to <code class="code">t</code>.</div>
<pre class="odoccode"><span class="VALwrite"><span class="keyword">val</span> write</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; 'a -&gt; unit</code></pre><div class="info"><code class="code">write t a</code> enqueues <code class="code">a</code> on the bus, but does not call any subscriber functions
immediately. Multiple <code class="code">write</code> calls in the same Async cycle are efficient (i.e. they
don't create a deferred per item).</div>
<div class="ocaml_module" name="Subscriber"><pre class="odoccode"><span class="keyword">module</span> <a href="http://127.0.0.1:8000/async_extra/#Bus.Subscriber" class="ocaml_internal">Subscriber</a> : <code class="type"><code class="code">sig</code> .. <code class="code">end</code></code></pre><div class="ocaml_summary"><div class="info"><code class="code">subscribe_exn t ~f</code> causes <code class="code">f</code> to be applied to all values subsequently written to
<code class="code">t</code> (or if <code class="code">t</code> is unstarted, to prior values as well). <code class="code">subscribe_exn</code> raises if it
is called on a started bus with <code class="code">not can_subscribe_after_start</code>. The function <code class="code">f</code> is
allowed to call other <code class="code">Bus</code> functions on <code class="code">t</code>, e.g. <code class="code">write</code>, <code class="code">subscribe_exn</code>, or
<code class="code">unsubscribe</code>.<p>If <code class="code">f</code> raises, the corresponding subscriber will be automatically unsubscribed, and
the exception will be sent to the monitor in effect when <code class="code">subscribe_exn</code> was called.</p><p>Once <code class="code">unsubscribe t subscriber</code> is called, <code class="code">f</code> will never be called again.</p></div></div><div class="ocaml_content">
<pre class="odoccode"><span class="TYPEt"><span class="keyword">type</span> <code class="type">'a </code>t</span></pre>
<pre class="odoccode"><span class="VALsexp_of_t"><span class="keyword">val</span> sexp_of_t</span> : <code class="type">('a -&gt; <a href="http://127.0.0.1:8000/sexplib/#Sexp.t">Sexplib.Sexp.t</a>) -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.Subscriber.t" class="ocaml_internal">t</a> -&gt; <a href="http://127.0.0.1:8000/sexplib/#Sexp.t">Sexplib.Sexp.t</a></code></pre></div></div>
<pre class="odoccode"><span class="VALsubscribe_exn"><span class="keyword">val</span> subscribe_exn</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; f:('a -&gt; unit) -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.Subscriber.t" class="ocaml_internal">Subscriber.t</a></code></pre>
<pre class="odoccode"><span class="VALunsubscribe"><span class="keyword">val</span> unsubscribe</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.Subscriber.t" class="ocaml_internal">Subscriber.t</a> -&gt; unit</code></pre>
<pre class="odoccode"><span class="VALreader_exn"><span class="keyword">val</span> reader_exn</span> : <code class="type">'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Import.Pipe.Reader.t">Import.Pipe.Reader.t</a></code></pre><div class="info"><code class="code">reader_exn t</code> returns a pipe that contains all elements subsequently written to <code class="code">t</code>
(and including prior values, if <code class="code">t</code> is unstarted). The difference with
<code class="code">subscribe_exn</code> is that the consumer may be an arbitrary amount behind other
subscribers/consumers. Pushback on the pipe is not honored. Closing the reader is
equivalent to calling <code class="code">unsubscribe</code>.</div>
<pre class="odoccode"><span class="VALsexp_of_t"><span class="keyword">val</span> sexp_of_t</span> : <code class="type">('a -&gt; <a href="http://127.0.0.1:8000/sexplib/#Sexp.t">Sexplib.Sexp.t</a>) -&gt; 'a <a href="http://127.0.0.1:8000/async_extra/#Bus.t" class="ocaml_internal">t</a> -&gt; <a href="http://127.0.0.1:8000/sexplib/#Sexp.t">Sexplib.Sexp.t</a></code></pre>
</div></div>